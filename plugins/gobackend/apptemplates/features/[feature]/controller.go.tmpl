package {{ .PackageName }}

import (
	"context"
	"log/slog"

	"github.com/{{ .AppNameToPackageName }}/config"
	"github.com/{{ .AppNameToPackageName }}/container"
	"github.com/{{ .AppNameToPackageName }}/features/auth"
	"github.com/{{ .AppNameToPackageName }}/types"

	validation "github.com/go-ozzo/ozzo-validation"
)

type {{ .FieldTypeGoName }}Controller struct {
	{{ .FeatureNameLowerCamel }} {{ .FieldTypeGoName }}Service
	logger  *slog.Logger
	cfg     config.Config
}

func New{{ .FieldTypeGoName }}Controller(cont container.Container) {{ .FieldTypeGoName }}Controller {
	authorizationService := auth.NewAuthorizationService(cont, "{{ .FeatureNameLowerCamel }}")
	{{ .FeatureNameLowerCamel }}Service := New{{ .FieldTypeGoName }}Service(cont, authorizationService)

	return {{ .FieldTypeGoName }}Controller{
		{{ .FeatureNameLowerCamel }}: {{ .FeatureNameLowerCamel }}Service,
		logger:  cont.GetLogger(),
		cfg:     cont.GetConfig(),
	}
}

func (ctrl {{ .FieldTypeGoName }}Controller) GetByID(ctx context.Context, id string) (*{{ .FieldTypeGoName }}Model, error) {
	if err := validation.Validate(id, types.Required("{{ .FeatureNameLowerCamel }}ID")); err != nil {
		return nil, err
	}

	result, err := ctrl.{{ .FeatureNameLowerCamel }}.GetByID(ctx, id)
	if err != nil {
		return nil, err
	}

	if result.IsDefault() {
		return nil, nil
	}

	return result, nil
}

func (ctrl {{ .FieldTypeGoName }}Controller) Get(ctx context.Context, filter {{ .FieldTypeGoName }}ListRequestParams) (*{{ .FieldTypeGoName }}ListResponse, error) {
	return ctrl.{{ .FeatureNameLowerCamel }}.Get(ctx, filter)
}

func (ctrl {{ .FieldTypeGoName }}Controller) Create(ctx context.Context, value {{ .FieldTypeGoName }}Model) error {
	if err := value.CreateValidate(); err != nil {
		return err
	}
	return ctrl.{{ .FeatureNameLowerCamel }}.Create(ctx, value)
}

func (ctrl {{ .FieldTypeGoName }}Controller) Update(ctx context.Context, value {{ .FieldTypeGoName }}Model) error {
	if err := value.UpdateValidate(); err != nil {
		return err
	}

	return ctrl.{{ .FeatureNameLowerCamel }}.Update(ctx, value)
}

func (ctrl {{ .FieldTypeGoName }}Controller) Delete(ctx context.Context, id string) error {
	if err := validation.Validate(id, types.Required("{{ .FeatureNameLowerCamel }}ID")); err != nil {
		return err
	}

	return ctrl.{{ .FeatureNameLowerCamel }}.Delete(ctx, id)
}
